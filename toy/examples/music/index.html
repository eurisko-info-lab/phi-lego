<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Theory Tutorial - Lego DSL</title>
    <style>
        :root {
            --bg: #fafafa;
            --fg: #1a1a1a;
            --accent: #2563eb;
            --accent-light: #60a5fa;
            --border: #e5e7eb;
            --code-bg: #f3f4f6;
            --success: #22c55e;
            --error: #ef4444;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #1a1a1a;
                --fg: #fafafa;
                --accent: #60a5fa;
                --accent-light: #93c5fd;
                --border: #374151;
                --code-bg: #262626;
            }
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--fg);
            line-height: 1.6;
        }
        
        .app {
            display: flex;
            min-height: 100vh;
        }
        
        .nav {
            width: 220px;
            background: var(--code-bg);
            padding: 1.5rem;
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .nav h2 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            color: var(--accent);
        }
        
        .nav ul {
            list-style: none;
        }
        
        .nav li {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-radius: 0.5rem;
            margin-bottom: 0.25rem;
            transition: all 0.2s;
        }
        
        .nav li:hover {
            background: var(--border);
        }
        
        .nav li.active {
            background: var(--accent);
            color: white;
        }
        
        .main {
            margin-left: 220px;
            display: flex;
            flex: 1;
        }
        
        .content {
            flex: 1;
            padding: 2rem 3rem;
            max-width: 800px;
        }
        
        .content h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 0.5rem;
        }
        
        .content h3 {
            font-size: 1.25rem;
            margin: 1.5rem 0 0.75rem;
            color: var(--accent);
        }
        
        .content p {
            margin-bottom: 1rem;
        }
        
        pre.code, pre.tab {
            background: var(--code-bg);
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'SF Mono', Consolas, monospace;
            font-size: 0.9rem;
            margin: 0.5rem 0;
        }
        
        td.code {
            font-family: 'SF Mono', Consolas, monospace;
            font-size: 0.85rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        th, td {
            border: 1px solid var(--border);
            padding: 0.5rem 0.75rem;
            text-align: left;
        }
        
        th {
            background: var(--code-bg);
            font-weight: 600;
        }
        
        /* Piano */
        .piano {
            display: flex;
            gap: 2px;
            padding: 1rem 0;
            overflow-x: auto;
        }
        
        .key {
            border: 1px solid #333;
            cursor: pointer;
            transition: all 0.1s;
        }
        
        .key.white {
            width: 40px;
            height: 120px;
            background: white;
            border-radius: 0 0 4px 4px;
        }
        
        .key.black {
            width: 28px;
            height: 75px;
            background: #1a1a1a;
            margin: 0 -14px;
            z-index: 1;
            border-radius: 0 0 4px 4px;
        }
        
        .key:hover {
            opacity: 0.8;
        }
        
        .key:active, .key.playing {
            transform: translateY(2px);
        }
        
        .key.white:active { background: #e0e0e0; }
        .key.black:active { background: #333; }
        
        /* Scale notes */
        .scale-notes {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin: 1rem 0;
        }
        
        .scale-note {
            padding: 0.75rem 1.25rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .scale-note:hover {
            background: var(--accent-light);
            transform: translateY(-2px);
        }
        
        /* Chord buttons */
        .chord-buttons {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .chord-btn {
            padding: 1rem 2rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1.25rem;
            font-weight: bold;
        }
        
        .chord-btn:hover {
            background: var(--accent-light);
        }
        
        /* Interactive sidebar */
        .interactive {
            width: 320px;
            background: var(--code-bg);
            padding: 1.5rem;
            border-left: 1px solid var(--border);
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }
        
        .interactive h3 {
            margin-bottom: 1rem;
            color: var(--accent);
        }
        
        .interactive h4 {
            margin: 1.5rem 0 0.5rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.7;
        }
        
        .input {
            width: 100%;
            padding: 0.75rem;
            font-family: 'SF Mono', Consolas, monospace;
            font-size: 0.9rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg);
            color: var(--fg);
            resize: vertical;
        }
        
        .result {
            margin: 1rem 0;
            padding: 0.75rem;
            background: var(--bg);
            border-radius: 0.5rem;
            border: 1px solid var(--border);
        }
        
        .result pre {
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }
        
        .success { color: var(--success); }
        .error { color: var(--error); }
        
        .examples {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .example-btn {
            padding: 0.5rem 0.75rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            font-family: 'SF Mono', Consolas, monospace;
            font-size: 0.75rem;
            text-align: left;
            cursor: pointer;
            color: var(--fg);
            transition: all 0.2s;
        }
        
        .example-btn:hover {
            border-color: var(--accent);
            background: var(--code-bg);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .interactive { display: none; }
        }
        
        @media (max-width: 768px) {
            .nav { display: none; }
            .main { margin-left: 0; }
            .content { padding: 1.5rem; }
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <script src="main.js"></script>
    <script>
        // Initialize Elm app
        var app = Elm.Main.init({
            node: document.getElementById('app')
        });
        
        // Web Audio API for sound
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function midiToFreq(midi) {
            return 440 * Math.pow(2, (midi - 69) / 12);
        }
        
        function playNote(midi, duration = 0.5) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.frequency.value = midiToFreq(midi);
            osc.type = 'sine';
            
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }
        
        // Handle clicks on piano keys and buttons
        document.addEventListener('click', function(e) {
            const key = e.target.closest('.key, .scale-note, .chord-btn');
            if (key) {
                // Resume audio context on user interaction
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }
                
                // Get MIDI note from data attribute or calculate from class
                let midi = 60; // Default to middle C
                
                if (key.classList.contains('key')) {
                    const allKeys = Array.from(document.querySelectorAll('.key'));
                    const index = allKeys.indexOf(key);
                    midi = 48 + index;
                } else if (key.classList.contains('scale-note')) {
                    const note = key.textContent;
                    const noteMap = {'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11};
                    const base = noteMap[note.charAt(0)] || 0;
                    midi = 60 + base;
                } else if (key.classList.contains('chord-btn')) {
                    const note = key.textContent;
                    const noteMap = {'C': 60, 'D': 62, 'E': 64, 'F': 65, 'G': 67, 'A': 69, 'B': 71};
                    midi = noteMap[note] || 60;
                }
                
                playNote(midi);
            }
        });
    </script>
</body>
</html>
